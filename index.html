<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Maker</title>
  </head>
  <body>
    <label>Title: <input id="title" minlength="1" maxlength="50"></label>
    <br>
    <label>Icon: <input id="icon" type="file"></label>
    <br>
    <label>Version: <input id="version" minlength="1" maxlength="20"></label>
    <br>
    <label>Author: <input id="author" minlength="1" maxlength="20"></label>
    <br>
    <label>Description: <input id="desc" maxlength="250"></label>
    <hr>
    <b>Hooks:</b>
    <br>
    <button id="new">New</button>
    <div id="hooks"></div>
    <select id="type">
      <option>JS</option>
    </select>
    <br>
    <textarea id="code"></textarea>
    <hr>
    <label>Pretty <input id="pretty" type="checkbox"></label>
    <br>
    <button id="make">Make!</button>
    <a id="down" style="display:none"></a>
    <script>
      let hooks = {};
      function hookshow() {
        document.getElementById('hooks').innerHTML = Object.entries(hooks).map(h=>`<span><button onclick="hookselect('${h[0]}')">${h[0]}</button> <button onclick="hookrem('${h[0]}')">x</button></span>`);
      }
      function hookselect(hook) {
        document.getElementById('code').value = hooks[hook].content;
      }
      function hookrem(hook) {
        delete hooks[hook];
      }
      document.getElementById('new').onclick = ()=>{
        let hook = prompt('hook name');
        if (!hook) return;
        if (hooks[hook]) {
          alert(hook+' already exists');
          return;
        }
        hooks[hook] = { type: document.getElementById('type').value, code: ''};
        hookshow();
        hookselect(hook);
      };
      document.getElementById('make').onclick = async()=>{
        let json = {};
        json.title = document.getElementById('title').value;
        json.icon = document.getElementById('icon').files[0];
        json.version = document.getElementById('version').value;
        json.author = document.getElementById('author').value;
        json.desc = document.getElementById('desc').value;

        if (json.icon) {
          await new Promise((resolve)=>{
            const reader = new FileReader();
            reader.onload = ()=>{
              json.icon = reader.result;
              resolve();
            };
            reader.readAsDataURL(json.icon);
          });
        }

        json.hooks = hooks;

        let content = document.getElementById('pretty').checked?JSON.stringify(json, null, 2):JSON.stringify(json);
        content = URL.createObjectURL(new Blob([content], { type: 'application/json' }));

        let a = document.getElementById('down');
        a.download = json.title.replaceAll(/[^a-zA-Z0-9_-]/g,'_')+'.json';
        a.href = content;
        a.click();
        URL.revokeObjectURL(content);
      };
    </script>
  </body>
</html>